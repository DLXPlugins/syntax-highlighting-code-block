#!/usr/bin/env php
<?php
// phpcs:ignoreFile

$languages_directory = sprintf( '%s/node_modules/highlight.js/src/languages', dirname( __DIR__ ) );
if ( ! file_exists( $languages_directory ) ) {
	echo "Please first npm install\n";
	exit( 1 );
}

$output_file_php = dirname( __DIR__ ) . '/language-names.php';

$language_names = [];

$language_files = glob( $languages_directory . '/*.js' );
sort( $language_files );
foreach ( $language_files as $language_file ) {
	$slug = basename( $language_file, '.js' );

	if ( ! preg_match( '#^\s*/\*\s*Language:\s*(.+?)\n#s', file_get_contents( $language_file ), $matches ) ) {
		echo "Unable to parse Language from $language_file\n";
		exit( 2 );
	}

	$language_names[ $slug ] = $matches[1];
}

$php  = "<?php\n// phpcs:ignoreFile\n";
$php .= sprintf( "// File generated by %s. Do not edit directly.\n", basename( __DIR__ ) . '/' . basename( __FILE__ ) );
$php .= "return [\n";
foreach ( $language_names as $slug => $name ) {
	$php .= sprintf(
		"\t%s => __( %s, 'syntax-highlighting-code-block' ),\n",
		var_export( $slug, true ),
		var_export( $name, true )
	);
}
$php .= "];\n";

if ( ! file_put_contents( $output_file_php, $php ) )  {
	echo "Unable to write to $output_file_php\n";
	exit( 1 );
}

echo "Done. Wrote to $output_file_php.\n";
